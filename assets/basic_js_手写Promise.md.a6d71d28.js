import{o as n,c as s,e as a}from"./app.aafdd98c.js";const p='{"title":"æ‰‹å†™å®Œæ•´Promise A+ ã€é™„æºç ã€‘","description":"","frontmatter":{},"headers":[{"level":2,"title":"å†™åœ¨å‰é¢çš„è¯","slug":"å†™åœ¨å‰é¢çš„è¯"},{"level":2,"title":"Promise A+è§„èŒƒ","slug":"promise-a-è§„èŒƒ"},{"level":2,"title":"PromiseåŸºç¡€ç‰ˆ","slug":"promiseåŸºç¡€ç‰ˆ"},{"level":2,"title":"Promiseå¤„ç†å¼‚æ­¥","slug":"promiseå¤„ç†å¼‚æ­¥"},{"level":2,"title":"Promiseé“¾å¼è°ƒç”¨(æ ¸å¿ƒ)","slug":"promiseé“¾å¼è°ƒç”¨-æ ¸å¿ƒ"},{"level":2,"title":"å®Œæ•´Promiseä»£ç ","slug":"å®Œæ•´promiseä»£ç "},{"level":2,"title":"æµ‹è¯•","slug":"æµ‹è¯•"}],"relativePath":"basic/js/æ‰‹å†™Promise.md","lastUpdated":1659153429813}',t={},o=[a('<h1 id="æ‰‹å†™å®Œæ•´promise-a-ã€é™„æºç ã€‘">æ‰‹å†™å®Œæ•´Promise A+ ã€é™„æºç ã€‘</h1><p><img src="https://qn.huat.xyz/mac/20220724100041.jpg" alt="js-promise"></p><h2 id="å†™åœ¨å‰é¢çš„è¯">å†™åœ¨å‰é¢çš„è¯</h2><p>çœ‹äº†å¸‚é¢ä¸Šçš„ä¸€äº›æ‰‹å†™Promiseï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸æ€ä¹ˆè§„èŒƒï¼Œè¦ä¹ˆæ— æ³•å¤„ç†å¼‚æ­¥ï¼Œè¦ä¹ˆæ²¡æœ‰trycatchï¼Œè¦ä¹ˆæ²¡æœ‰å‘å¸ƒè®¢é˜…çš„åŠŸèƒ½ï¼Œè¦ä¹ˆæ²¡æœ‰å®ç°é“¾å¼è°ƒç”¨ç­‰ç­‰ã€‚é‚£ä¹ˆä»Šå¤©å°±æ¥å®ç°ä¸€ä¸ªç¬¦åˆPromise A+è§„èŒƒçš„ä»£ç ã€‚æ—¢ç„¶æ¥çœ‹æ‰‹å†™ï¼Œé‚£ä¹ˆè‚¯å®šå¯¹Promiseéƒ½æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥ä¸Šæ‰‹ã€‚</p><h2 id="promise-a-è§„èŒƒ">Promise A+è§„èŒƒ</h2><p>Promise/A+è§„èŒƒåŸæ–‡: <a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">https://promisesaplus.com/</a></p><p>Promise/A+è§„èŒƒè¯‘æ–‡: <a href="http://www.ituring.com.cn/article/66566" target="_blank" rel="noopener noreferrer">http://www.ituring.com.cn/article/66566</a></p><p>ä»¥ä¸‹ä¸ºæµ‹è¯•æˆåŠŸæˆªå›¾</p><p><img src="https://qn.huat.xyz/mac/20220723204501.png" alt="image-20220723204501253"></p><h2 id="promiseåŸºç¡€ç‰ˆ">PromiseåŸºç¡€ç‰ˆ</h2><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span>\n<span class="token keyword">const</span> <span class="token constant">FAIL</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span>\n<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span>\n<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// é»˜è®¤æ˜¯ç­‰å¾…æ€</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span> \n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token comment">// åªæœ‰çŠ¶æ€ä¸º PENDING æ—¶æ‰å…è®¸ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºpromiseçŠ¶æ€ä¸å¯é€†</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">SUCCESS</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason\n        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FAIL</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// new Promise() æŠ¥é”™çš„æ—¶å€™ä¹Ÿä¼šæ‰§è¡Œ reject()</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ç«‹å³æ‰§è¡Œ</span>\n      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> \n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FAIL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise\n</code></pre></div><h2 id="promiseå¤„ç†å¼‚æ­¥">Promiseå¤„ç†å¼‚æ­¥</h2><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span>\n<span class="token keyword">const</span> <span class="token constant">FAIL</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span>\n<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span>\n<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// é»˜è®¤æ˜¯ç­‰å¾…æ€</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>\n    <span class="token comment">// å­˜å‚¨æˆåŠŸçš„æ‰€æœ‰çš„å›è°ƒ åªæœ‰pendingçš„æ—¶å€™æ‰å­˜å‚¨</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token comment">// å­˜å‚¨æ‰€æœ‰å¤±è´¥çš„</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token comment">// åªæœ‰çŠ¶æ€ä¸º PENDING æ—¶æ‰å…è®¸ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºpromiseçŠ¶æ€ä¸å¯é€†</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">SUCCESS</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason\n        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FAIL</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// executor ä¸­æŠ›å‡ºé”™è¯¯æ—¶ä¹Ÿä¼šæ‰§è¡Œ reject()</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ç«‹å³æ‰§è¡Œ</span>\n      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">/**\n   * @description:\n   * thenæ–¹æ³•ä¼šç”¨åˆ°ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå¤„ç† executor ä¸­çš„å¼‚æ­¥ä»£ç .\n   * å¦‚æœresolve()çš„æ˜¯ä¸€ä¸ªPromiseï¼Œä¼šè‡ªåŠ¨å°†è¿™ä¸ªpromiseæ‰§è¡Œï¼Œå¹¶ä¸”é‡‡ç”¨ä»–çš„çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸä¼šå°†æˆåŠŸçš„ç»“æœå‘ä¸‹ä¸€å±‚ä¼ é€’ï¼Œ\n   * å¦‚æœthenæ–¹æ³•ä¸­çš„æˆåŠŸæˆ–è€…å¤±è´¥ æ‰§è¡Œçš„æ—¶å€™å‘ç”Ÿé”™è¯¯ ä¼šèµ°ä¸‹ä¸€ä¸ªthençš„å¤±è´¥çš„å›è°ƒ\n   * å¦‚æœthenæ–¹æ³•è¿”å›äº†ä¸€ä¸ªå¤±è´¥çš„promiseä»–ä¼šèµ°å¤–å±‚thençš„å¤±è´¥çš„å›è°ƒ\n   *  1ã€ï¼ˆthenä¸­ä¼ é€’çš„å‡½æ•°ï¼‰åˆ¤æ–­æˆåŠŸ/å¤±è´¥å‡½æ•°çš„è¿”å›ç»“æœ\n   *  2ã€ å¦‚æœæ˜¯ promise åˆ™ï¼Œé‡‡ç”¨å®ƒçš„ç»“æœ\n   *  3ã€ å¦‚æœä¸æ˜¯promise åˆ™ï¼Œç»§ç»­å°†ç»“æœä¼ é€’ä¸‹å»\n   * @param {*} onFulfilled\n   * @param {*} onRejected\n   */</span>\n  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//  åŒæ­¥å¤„ç†</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FAIL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// å¦‚æœæ˜¯PENDINGçŠ¶æ€ï¼Œé‚£ä¹ˆåº”è¯¥å°†å‡½æ•°å­˜èµ·æ¥ åˆ†ç»„å­˜æ”¾ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å¦‚æœæ˜¯å¼‚æ­¥ï¼Œå…ˆè®¢é˜…å¥½</span>\n      <span class="token comment">// push() å‚æ•°ä¸ºä»€ä¹ˆæ˜¯å‡½æ•°ï¼Ÿ</span>\n      <span class="token comment">// this.onResolvedCallbacks.push(onFulfilled(this.value));</span>\n      <span class="token comment">// è¿™æ ·åšä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯æ— æ³•æ·»åŠ ä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚åœ¨æ·»åŠ å‡½æ•°å‰åšä¸€äº›é€»è¾‘ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨å‡½æ•°çš„æ–¹å¼</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token comment">// è¿™é‡Œå¯ä»¥æ·»åŠ é¢å¤–çš„é€»è¾‘</span>\n        <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise\n</code></pre></div><h2 id="promiseé“¾å¼è°ƒç”¨-æ ¸å¿ƒ">Promiseé“¾å¼è°ƒç”¨(æ ¸å¿ƒ)</h2><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;PENDING&#39;</span>\n<span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&#39;FULFILLED&#39;</span>\n<span class="token keyword">const</span> <span class="token constant">FAIL</span> <span class="token operator">=</span> <span class="token string">&#39;REJECTED&#39;</span>\n\n<span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// å¦‚æœ promise2 å’Œ x ç›¸åŒï¼ŒæŠ›å‡ºé”™è¯¯</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>\n      <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&#39;TypeError: Chaining cycle detected for promise #&lt;Promise&gt;&#39;</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// åˆ¤æ–­xçš„ç±»å‹</span>\n  <span class="token comment">// promise æœ‰nç§å®ç° éƒ½ç¬¦åˆäº†è¿™ä¸ªè§„èŒƒ å…¼å®¹åˆ«äººçš„promise</span>\n  <span class="token comment">// ä¸¥è°¨ ğŸ‡¬åº”è¯¥åˆ¤æ–­ åˆ«äººçš„promise å¦‚æœå¤±è´¥äº†å°±ä¸èƒ½åœ¨è°ƒç”¨æˆåŠŸ å¦‚æœæˆåŠŸäº†ä¸èƒ½åœ¨è°ƒç”¨å¤±è´¥</span>\n  <span class="token keyword">let</span> called\n\n  <span class="token comment">// æ€ä¹ˆåˆ¤æ–­ xæ˜¯ä¸æ˜¯ä¸€ä¸ªpromise çœ‹ä»–æœ‰æ²¡æœ‰thenæ–¹æ³•</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å–thenæ–¹æ³•å¯èƒ½ä¼šå‡ºé”™ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ trycatch</span>\n      <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// å¦‚æœ then ä¸º ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘å°±è®¤ä¸ºä»–æ˜¯ä¸€ä¸ªpromise</span>\n        <span class="token comment">// ç›´æ¥ä½¿ç”¨å–å¥½çš„thenï¼Œè€Œä¸æ˜¯ä½¿ç”¨x.thenï¼Œå¦åˆ™ä¼šåœ¨æ¬¡å–å€¼ï¼Œæœ‰å¯èƒ½ç¬¬ä¸€æ¬¡å–å€¼æ²¡æœ‰æŠ¥é”™ï¼Œç¬¬äºŒæ¬¡å–å€¼å°±æŠ¥é”™äº†</span>\n        <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>\n          x<span class="token punctuation">,</span>\n          <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token comment">// å¦‚æœpromiseæ˜¯æˆåŠŸçš„å°±æŠŠç»“æœå‘ä¸‹ä¼ ï¼Œå¦‚æœå¤±è´¥çš„å°±è®©ä¸‹ä¸€ä¸ªäººä¹Ÿå¤±è´¥</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>\n            called <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// é˜²æ­¢å¤šæ¬¡è°ƒç”¨æˆåŠŸå’Œå¤±è´¥</span>\n            <span class="token comment">// resolve(y)</span>\n            <span class="token comment">// ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ é€’å½’ï¼Ÿ æŸ¥çœ‹1.test.js çš„æƒ…å†µ, resolve()è¿”å› promise</span>\n            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token comment">// é€’å½’</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>\n            called <span class="token operator">=</span> <span class="token boolean">true</span>\n            <span class="token comment">// æŠ¥é”™çš„æ—¶å€™å°±ç›´æ¥å¾€ä¸‹èµ°ï¼Œä¸ç”¨å†æ‹…å¿ƒ æ˜¯ä¸æ˜¯ peomise äº†</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">)</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token comment">// {then:()=&gt;{}}</span>\n        <span class="token comment">// è¯´æ˜ x æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œç›´æ¥æˆåŠŸå³å¯</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ä¸ºäº†è¾¨åˆ«è¿™ä¸ªpromise é˜²æ­¢è°ƒç”¨å¤šæ¬¡</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>\n      called <span class="token operator">=</span> <span class="token boolean">true</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token comment">// xæ˜¯ä¸ªï¼Ÿ å¸¸é‡</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value\n        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">SUCCESS</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason\n        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FAIL</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// åŒä¸€ä¸ªpromise then å¤šæ¬¡</span>\n  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// å¤„ç† 2.test.js ä¸­çš„æƒ…å†µ</span>\n    onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> val\n    onRejected <span class="token operator">=</span>\n      <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span>\n        <span class="token operator">?</span> <span class="token function-variable function">onRejected</span>\n        <span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token comment">// å°†å¤±è´¥å‘ä¸‹ä¼ é€’</span>\n            <span class="token keyword">throw</span> err\n          <span class="token punctuation">}</span>\n    <span class="token keyword">let</span> promise2\n    <span class="token comment">// å¯ä»¥ä¸åœçš„è°ƒç”¨thenæ–¹æ³•,è¿”è¿˜äº†ä¸€ä¸ªæ–°çš„promise</span>\n    <span class="token comment">// å¼‚æ­¥çš„ç‰¹ç‚¹ ç­‰å¾…å½“å‰ä¸»æ ˆä»£ç éƒ½æ‰§è¡Œåæ‰æ‰§è¡Œ</span>\n    promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ setTimeout ï¼Ÿ å¦‚æœä¸ä½¿ç”¨ setTimeout ï¼Œpromise2 åˆ™ä¼šæŠ¥é”™ï¼Œæ¶‰åŠåˆ°ä»£ç çš„æ‰§è¡Œé¡ºåºé—®é¢˜ï¼Œéœ€è¦å…ˆ newå®Œåå†å°†ç»“æœèµ‹å€¼ç»™ promise2 å¯ä»¥å»æ‰  setTimeout æ‰“å°ä¸€ä¸‹ promise2 çœ‹çœ‹</span>\n        <span class="token comment">// setTimeoutä½œç”¨ï¼š ä¸ºäº†ä¿è¯ promise2 å·²ç» new å®Œäº†</span>\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token comment">// try catch ç”¨äº æ•è· onFulfilled å‡½æ•°çš„å¼‚å¸¸ï¼Œæ¯”å¦‚ åœ¨æ‰§è¡Œ onFulfilled å‡½æ•°çš„æ—¶å€™æŠ›é”™ï¼Œ æˆ–è€… onFulfilled å‡½æ•°ä¸­ æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯</span>\n          <span class="token comment">// constructor ä¸­çš„ try catch æ— æ³•æ•è·è¿™é‡Œå¼‚æ­¥ä»£ç çš„å¼‚å¸¸</span>\n          <span class="token keyword">try</span> <span class="token punctuation">{</span>\n            <span class="token comment">// è°ƒç”¨å½“å‰thenæ–¹æ³•çš„ç»“æœï¼Œæ¥åˆ¤æ–­å½“å‰è¿™ä¸ªpromise2 æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥</span>\n            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n            <span class="token comment">// è¿™é‡Œçš„xæ˜¯æ™®é€šå€¼è¿˜æ˜¯promise  å¦‚æœæ˜¯ä¸€ä¸ªpromiseå‘¢ï¼Ÿ</span>\n            <span class="token comment">// console.log(&#39;then-SUCCESS&#39;, promise2);</span>\n            <span class="token comment">// åˆ¤æ–­ x å’Œ promise2 å’Œ promise çš„å…³ç³»</span>\n            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise2--catch &#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FAIL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token keyword">try</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>\n            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token keyword">try</span> <span class="token punctuation">{</span>\n              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token keyword">try</span> <span class="token punctuation">{</span>\n              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>\n              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> promise2\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise\n</code></pre></div><h4 id="_1-test-js">1.test.js</h4><div class="language-js"><pre><code><span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./promise&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> p2 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;1000&#39;</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\np2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span>\n</code></pre></div><h4 id="_2-test-js">2.test.js</h4><div class="language-js"><pre><code><span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./promise&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><h2 id="å®Œæ•´promiseä»£ç ">å®Œæ•´Promiseä»£ç </h2><p><a href="https://github.com/SuYxh/Write_Promise_A_Plus" target="_blank" rel="noopener noreferrer">https://github.com/SuYxh/Write_Promise_A_Plus</a></p><h2 id="æµ‹è¯•">æµ‹è¯•</h2><p>ä½¿ç”¨<code>promises-aplus-tests</code>è¿™ä¸ªåº“æ˜¯å¦ç¬¦åˆ promise A+è§„èŒƒ</p><div class="language-"><pre><code>npm i promises-aplus-tests -g\n</code></pre></div><p>ç„¶ååœ¨promiseä¸­æ·»åŠ ï¼š</p><div class="language-js"><pre><code>Promise<span class="token punctuation">.</span>defer <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function-variable function">deferred</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token keyword">let</span> dfd <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  dfd<span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>\n    dfd<span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>\n    dfd<span class="token punctuation">.</span>reject <span class="token operator">=</span> reject<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> dfd<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>ç„¶åæ‰§è¡Œï¼š</p><div class="language-"><pre><code>promises-aplus-tests promise.js\n</code></pre></div><p><img src="https://qn.huat.xyz/mac/20220723215501.png" alt="image-20220723204501253"></p>',29)];t.render=function(a,p,t,e,c,l){return n(),s("div",null,o)};export default t;export{p as __pageData};
