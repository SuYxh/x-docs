![](https://qn.huat.xyz/mac/20220716185129.png)

**ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—**

ä¸“æ³¨ Node.js æŠ€æœ¯æ ˆåˆ†äº«ï¼Œä» å‰ç«¯ åˆ° Node.js å†åˆ° åç«¯æ•°æ®åº“ï¼Œç¥æ‚¨æˆä¸ºä¼˜ç§€çš„é«˜çº§ Node.js å…¨æ ˆå·¥ç¨‹å¸ˆã€‚ä¸€ä¸ªæœ‰è¶£çš„ä¸”ä¹äºåˆ†äº«çš„äººã€‚åº§å³é“­ï¼šä»Šå¤©æœªå®Œæˆçš„ï¼Œæ˜å¤©æ›´ä¸ä¼šå®Œæˆã€‚

94ç¯‡åŸåˆ›å†…å®¹

å…¬ä¼—å·

å¤§å‚æŠ€æœ¯Â Â é«˜çº§å‰ç«¯Â Â Nodeè¿›é˜¶

ç‚¹å‡»ä¸Šæ–¹Â ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—ï¼Œå…³æ³¨å…¬ä¼—å·  

å›å¤1ï¼ŒåŠ å…¥é«˜çº§Nodeäº¤æµç¾¤

> ä½œè€…ï¼šmolvqingtai
> 
> åŸæ–‡é“¾æ¥: https://juejin.cn/post/6971812117993226248

## å‰ç«¯å·¥ç¨‹åŒ–é…ç½®æŒ‡å—

> æœ¬æ–‡è®²è§£å¦‚ä½•æ„å»ºä¸€ä¸ªå·¥ç¨‹åŒ–çš„å‰ç«¯åº“ï¼Œå¹¶ç»“åˆ Github Actionsï¼Œè‡ªåŠ¨å‘å¸ƒåˆ° GithubÂ å’Œ NPMÂ çš„æ•´ä¸ªè¯¦ç»†æµç¨‹ã€‚

## ç¤ºä¾‹

> æˆ‘ä»¬ç»å¸¸çœ‹åˆ°åƒ Vueã€ReactÂ è¿™äº›æµè¡Œçš„å¼€æºé¡¹ç›®æœ‰å¾ˆå¤šé…ç½®æ–‡ä»¶ï¼Œä»–ä»¬æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿä»–ä»¬çš„ Commitã€Release è®°å½•éƒ½é‚£ä¹ˆè§„èŒƒï¼Œæ˜¯å¦åŸºäºæŸç§çº¦å®šï¼Ÿ

**åºŸè¯å°‘è¯´ï¼Œå…ˆä¸Šå›¾ï¼**

![å›¾ç‰‡](https://qn.huat.xyz/mac/20220716185137.png) ä¸Šå›¾æ ‡çº¢å°±æ˜¯ç›¸å…³çš„å·¥ç¨‹åŒ–é…ç½®ï¼Œæœ‰ Linterã€Testsï¼ŒGithub Actions ç­‰ï¼Œè¦†ç›–å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒçš„æ•´ä¸ªæµç¨‹ã€‚

**ç›¸å…³é…ç½®æ¸…å•**

-   Eslint
    
-   Prettier
    
-   Commitlint
    
-   Husky
    
-   Jest
    
-   GitHub Actions
    
-   Semantic Release
    

ä¸‹é¢æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ª TypeScript é¡¹ç›®å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥å®Œæˆæ‰€æœ‰çš„å·¥ç¨‹åŒ–é…ç½®ï¼Œå¹¶è¯´æ˜æ¯ä¸ªé…ç½®å«ä¹‰ä»¥åŠå®¹æ˜“è¸©çš„å‘ã€‚

## åˆå§‹åŒ–

ä¸ºäº†é¿å…å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®å…ˆå°† nodeÂ å‡çº§åˆ°æœ€æ–°çš„é•¿æœŸæ”¯æŒç‰ˆæœ¬ã€‚

é¦–å…ˆåœ¨ GithubÂ ä¸Šåˆ›å»ºä¸€ä¸ª repo,æ‹‰ä¸‹æ¥ä¹‹åé€šè¿‡`npm init -y`åˆå§‹åŒ–ã€‚ç„¶ååˆ›å»º`src`æ–‡ä»¶å¤¹ï¼Œå†™å…¥`index.ts`ã€‚

`package.json` ç”Ÿæˆä¹‹åï¼Œæˆ‘éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®é¡¹:

```auto
Â Â Â "main":Â "index.js",
+Â Â "type":Â "module",
Â Â Â "scripts":Â {
Â Â Â Â Â "test":Â "echoÂ \"Error:Â noÂ testÂ specified\"Â &&Â exitÂ 1"
Â Â Â },
+Â Â "publishConfig":Â {
+Â Â Â Â "access":Â "public"
+Â Â }
```

æˆ‘ä»¬å°†é¡¹ç›®å®šä¹‰ä¸ºESMè§„èŒƒ,å‰ç«¯ç¤¾åŒºæ­£é€æ¸å‘ESMæ ‡å‡†è¿ç§»ï¼Œä»Node v12.0.0å¼€å§‹ï¼Œåªè¦è®¾ç½®äº† `"type": "module"`, Node ä¼šå°†æ•´ä¸ªé¡¹ç›®è§†ä¸ºESMè§„èŒƒï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å†™è£¸å†™`import/export`ã€‚

`publishConfig.access`è¡¨ç¤ºå½“å‰é¡¹ç›®å‘å¸ƒåˆ°NPMçš„è®¿é—®çº§åˆ«ï¼Œå®ƒæœ‰ `restricted`å’Œ`public`ä¸¤ä¸ªé€‰é¡¹,`restricted`è¡¨ç¤ºæˆ‘ä»¬å‘å¸ƒåˆ°NPMä¸Šçš„æ˜¯ç§æœ‰åŒ…ï¼ˆæ”¶è´¹ï¼‰ï¼Œè®¿é—®çº§åˆ«é»˜è®¤ä¸º`restricted`,å› ä¸ºæˆ‘ä»¬æ˜¯å¼€æºé¡¹ç›®æ‰€ä»¥æ ‡è®°ä¸º`public`ã€‚

## é…ç½®

åˆ›å»ºé¡¹ç›®ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å®‰è£…å·¥ç¨‹åŒ–ç›¸å…³çš„ä¾èµ–ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ TypeScript é¡¹ç›®ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å®‰è£… TypeScript çš„ä¾èµ–ã€‚

### Typescript

å…ˆå®‰è£… TypeScriptï¼Œç„¶åä½¿ç”¨ `tsc` å‘½åç”Ÿæˆ `tsconfig.json`ã€‚

```auto
npmÂ iÂ typescriptÂ -D
npxÂ tscÂ --init
```

ç„¶åæˆ‘ä»¬éœ€è¦æ·»åŠ ä¿®æ”¹ `tsconfig.json` çš„é…ç½®é¡¹ï¼Œå¦‚ä¸‹ï¼š

```auto
{
Â Â "compilerOptions":Â {
Â Â Â Â /*Â BasicÂ OptionsÂ */
Â Â Â Â "baseUrl":Â ".",Â //Â æ¨¡å—è§£ææ ¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºÂ tsconfig.jsonÂ ä½äºçš„ç›®å½•
Â Â Â Â "rootDir":Â "src",Â //Â ç¼–è¯‘è§£ææ ¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºÂ tsconfig.jsonÂ ä½äºçš„ç›®å½•
Â Â Â Â "target":Â "ESNEXT",Â //Â æŒ‡å®šè¾“å‡ºÂ ECMAScriptÂ ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºÂ es5
Â Â Â Â "module":Â "ESNext",Â //Â æŒ‡å®šè¾“å‡ºæ¨¡å—è§„èŒƒï¼Œé»˜è®¤ä¸ºÂ Commonjs
Â Â Â Â "lib":Â ["ESNext",Â "DOM"],Â //Â ç¼–è¯‘éœ€è¦åŒ…å«çš„Â APIï¼Œé»˜è®¤ä¸ºÂ targetÂ çš„é»˜è®¤å€¼
Â Â Â Â "outDir":Â "dist",Â //Â ç¼–è¯‘è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºæºæ–‡ä»¶åŒçº§ç›®å½•
Â Â Â Â "sourceMap":Â true,Â //Â å¯ç”¨Â sourceMapï¼Œé»˜è®¤ä¸ºÂ false
Â Â Â Â "declaration":Â true,Â //Â ç”ŸæˆÂ .d.tsÂ ç±»å‹æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºÂ false
Â Â Â Â "declarationDir":Â "dist/types",Â //Â .d.tsÂ ç±»å‹æ–‡ä»¶çš„è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸ºÂ outDirÂ ç›®å½•
Â Â Â Â /*Â StrictÂ Type-CheckingÂ OptionsÂ */
Â Â Â Â "strict":Â true,Â //Â å¯ç”¨æ‰€æœ‰ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥é€‰é¡¹ï¼Œé»˜è®¤ä¸ºÂ true
Â Â Â Â "esModuleInterop":Â true,Â //Â é€šè¿‡ä¸ºå¯¼å…¥å†…å®¹åˆ›å»ºå‘½åç©ºé—´ï¼Œå®ç°Â CommonJSÂ å’ŒÂ ESÂ æ¨¡å—ä¹‹é—´çš„äº’æ“ä½œæ€§ï¼Œé»˜è®¤ä¸ºÂ true
Â Â Â Â "skipLibCheck":Â true,Â //Â è·³è¿‡å¯¼å…¥ç¬¬ä¸‰æ–¹Â libÂ å£°æ˜æ–‡ä»¶çš„ç±»å‹æ£€æŸ¥ï¼Œé»˜è®¤ä¸ºÂ true
Â Â Â Â "forceConsistentCasingInFileNames":Â true,Â //Â å¼ºåˆ¶åœ¨æ–‡ä»¶åä¸­ä½¿ç”¨ä¸€è‡´çš„å¤§å°å†™ï¼Œé»˜è®¤ä¸ºÂ true
Â Â Â Â "moduleResolution":Â "Node",Â //Â æŒ‡å®šä½¿ç”¨å“ªç§æ¨¡å—è§£æç­–ç•¥ï¼Œé»˜è®¤ä¸ºÂ Classic
Â Â },
Â Â "include":Â ["src"]Â //Â æŒ‡å®šéœ€è¦ç¼–è¯‘æ–‡ä»¶ï¼Œé»˜è®¤å½“å‰ç›®å½•ä¸‹é™¤äº†Â excludeÂ ä¹‹å¤–çš„æ‰€æœ‰.ts,Â .d.ts,.tsxÂ æ–‡ä»¶
}Â 
```

æ›´å¤šè¯¦ç»†é…ç½®å‚è€ƒï¼šwww.typescriptlang.org/tsconfig

æ³¨æ„çš„ç‚¹ï¼Œå¦‚æœä½ çš„é¡¹ç›®æ¶‰åŠåˆ°`WebWorker API`ï¼Œéœ€è¦æ·»åŠ åˆ° `lib` å­—æ®µä¸­

```auto
"lib":Â ["ESNext",Â "DOM",Â "WebWorker"],
```

ç„¶åæˆ‘ä»¬å°†ç¼–è¯‘åçš„æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ° `package.json`ï¼Œå¹¶åœ¨ `scripts` ä¸­æ·»åŠ ç¼–è¯‘å‘½ä»¤ã€‚

```auto
-Â Â "main":Â "index.js",
+Â Â "main":Â "dist/index.js",
+Â Â "types":Â "dist/types/index.d.ts"
Â Â Â "type":Â "module",
-Â Â Â "scripts":Â {
-Â Â Â Â Â "test":Â "echoÂ \"Error:Â noÂ testÂ specified\"Â &&Â exitÂ 1"
-Â Â Â },
+Â Â Â "scripts":Â {
+Â Â Â Â Â "dev":Â "tscÂ --watch",
+Â Â Â Â Â "build":Â "npmÂ runÂ cleanÂ &&Â tsc",
+Â Â Â Â Â "clean":Â "rmÂ -rfÂ dist"
+Â Â },
Â Â Â "publishConfig":Â {
Â Â Â Â Â "access":Â "public"
Â Â Â }
```

`types` é…ç½®é¡¹æ˜¯æŒ‡å®šç¼–è¯‘ç”Ÿæˆçš„ç±»å‹æ–‡ä»¶ï¼Œå¦‚æœ `compilerOptions.declarationDir` æŒ‡å®šçš„æ˜¯`dist`ï¼Œä¹Ÿå°±æ˜¯æºç å’Œ `.d.ts` åŒçº§ï¼Œé‚£ä¹ˆ`types`å¯ä»¥çœç•¥ã€‚

éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œåœ¨ `index.ts` å†™å…¥

```auto
constÂ calcÂ =Â (a:Â number,Â b:Â number)Â =>Â {
Â Â returnÂ aÂ -Â b
}
console.log(calc(1024,Â 28))
```

åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œ

```auto
npmÂ runÂ buildÂ &&Â nodeÂ dist/index.js
```

ä¼šåœ¨ `dist` ç›®å½•ä¸­ç”Ÿæˆ `types/index.d.ts`ã€`index.js`ã€`index.js.map`ï¼Œå¹¶æ‰“å° `996`ã€‚

### Eslint & Prettier

ä»£ç è§„èŒƒç¦»ä¸å¼€å„ç§ `Linter`, ä¹‹æ‰€ä»¥æŠŠè¿™ä¸¤ä¸ªæ”¾åœ¨ä¸€èµ·è®²ï¼Œå€Ÿç”¨ `Prettier` å®˜ç½‘çš„ä¸€å¥è¯ï¼šâ€œä½¿ç”¨ Prettier è§£å†³ä»£ç æ ¼å¼é—®é¢˜ï¼Œä½¿ç”¨ linters è§£å†³ä»£ç è´¨é‡é—®é¢˜â€ã€‚è™½ç„¶`eslint`ä¹Ÿæœ‰æ ¼å¼åŒ–åŠŸèƒ½ï¼Œä½†æ˜¯`prettier`çš„æ ¼å¼åŒ–åŠŸèƒ½æ›´å¼ºå¤§ã€‚

å¤§éƒ¨åˆ†åŒå­¦ç¼–è¾‘å™¨éƒ½è£…äº†prettier-vscodeå’Œeslint-vscodeè¿™ä¸¤ä¸ªæ’ä»¶ï¼Œå¦‚æœä½ é¡¹ç›®åªæœ‰å…¶ä¸­ä¸€ä¸ªçš„é…ç½®ï¼Œå› ä¸ºè¿™ä¸¤è€…éƒ¨åˆ†æ ¼å¼åŒ–çš„åŠŸèƒ½æœ‰å·®å¼‚ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸€ä¸ªçš„é—®é¢˜ï¼Œä»£ç åˆ†åˆ«è¢«ä¸¤ä¸ªæ’ä»¶åˆ†åˆ«æ ¼å¼åŒ–ä¸€æ¬¡ï¼Œç½‘ä¸Šè§£å†³`prettier`+`eslint`å†²çªçš„æ–¹æ¡ˆäº”èŠ±å…«é—¨ï¼Œç”šè‡³è¿˜æœ‰æŠŠæ•´ä¸ª`rules`åˆ—è¡¨è´´å‡ºæ¥çš„ã€‚

é‚£è¿™é‡Œæˆ‘ä»¬æŒ‰ç…§å®˜æ–¹æ¨èï¼Œç”¨æœ€å°‘çš„é…ç½®å»è§£å†³`prettier`å’Œ`eslint`çš„é›†æˆé—®é¢˜ã€‚

#### Eslint

é¦–å…ˆå®‰è£… `eslint`ï¼Œç„¶ååˆ©ç”¨ `eslint` çš„å‘½ä»¤è¡Œå·¥å…·ç”ŸæˆåŸºæœ¬é…ç½®ã€‚

```auto
npmÂ iÂ eslintÂ -D
npxÂ eslintÂ --init
```

æ‰§è¡Œä¸Šé¢å‘½ä»¤åä¼šæç¤ºä¸€äº›é€‰é¡¹ï¼Œæˆ‘ä»¬ä¾æ¬¡é€‰æ‹©ç¬¦åˆæˆ‘ä»¬é¡¹ç›®çš„é…ç½®ã€‚

æ³¨æ„ï¼Œè¿™é‡Œ `eslint` æ¨èäº†ä¸‰ç§ç¤¾åŒºä¸»æµçš„è§„èŒƒï¼ŒAirbnbã€Standardã€Googleï¼Œå› ä¸ªäººçˆ±å¥½æˆ‘é€‰æ‹©äº†ä¸å†™åˆ†å·çš„ Standardè§„èŒƒã€‚

ç”Ÿæˆçš„`.eslintrc.cjs`æ–‡ä»¶åº”è¯¥é•¿è¿™æ ·

```auto
module.exportsÂ =Â {
Â Â env:Â {
Â Â Â Â browser:Â true,
Â Â Â Â es2021:Â true,
Â Â Â Â node:Â true
Â Â },
Â Â extends:Â [
Â Â Â Â 'standard'
Â Â ],
Â Â parser:Â '@typescript-eslint/parser',
Â Â parserOptions:Â {
Â Â Â Â ecmaVersion:Â 12,
Â Â Â Â sourceType:Â 'module'
Â Â },
Â Â plugins:Â [
Â Â Â Â '@typescript-eslint'
Â Â ],
Â Â rules:Â {
Â Â }
}
```

æœ‰äº›åŒå­¦å¯èƒ½å°±è¦é—®äº†ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç”Ÿæˆçš„é…ç½®æ–‡ä»¶åç§°æ˜¯`.eslintrc.cjs`è€Œä¸æ˜¯`.eslintrc.js`ï¼Ÿ

å› ä¸ºæˆ‘ä»¬å°†é¡¹ç›®å®šä¹‰ä¸º`ESM`ï¼Œ`eslit --init`ä¼šè‡ªåŠ¨è¯†åˆ«`type`ï¼Œå¹¶ç”Ÿæˆå…¼å®¹çš„é…ç½®æ–‡ä»¶åç§°ï¼Œå¦‚æœæˆ‘ä»¬æ”¹å›`.js`ç»“å°¾ï¼Œå†è¿è¡Œ`eslint`å°†ä¼šæŠ¥é”™ã€‚å‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯`eslint`å†…éƒ¨ä½¿ç”¨äº†`require()`è¯­æ³•è¯»å–é…ç½®ã€‚

åŒæ ·ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿé€‚ç”¨äºå…¶ä»–åŠŸèƒ½çš„é…ç½®ï¼Œæ¯”å¦‚åé¢ä¼šè®²åˆ°çš„`Prettier`ã€`Commitlint`ç­‰ï¼Œé…ç½®æ–‡ä»¶éƒ½ä¸èƒ½ä»¥`xx.js`ç»“å°¾ï¼Œè€Œè¦æ”¹ä¸ºå½“å‰åº“æ”¯æŒçš„å…¶ä»–é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œå¦‚ï¼š`.xxrc`ã€`.xxrc.json`ã€`.xxrc.yml`ã€‚

éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œä¿®æ”¹`index.ts`

```auto
Â Â constÂ calcÂ =Â (a:Â number,Â b:Â number)Â =>Â {
Â Â Â Â returnÂ aÂ -Â b
Â Â }
-Â console.log(calc(1024,Â 28))
+Â //Â console.log(calc(1024,Â 28))
```

åœ¨`package.json`ä¸­æ·»åŠ `lint`å‘½ä»¤

```auto
Â Â "scripts":Â {
Â Â Â Â "dev":Â "tscÂ --watch",
Â Â Â Â "build":Â "npmÂ runÂ cleanÂ &&Â tsc",
+Â Â Â "lint":Â "eslintÂ srcÂ --extÂ .js,.tsÂ --cacheÂ --fix",
Â Â Â Â "clean":Â "rmÂ -rfÂ dist"
Â Â },
```

ç„¶ååœ¨æ§åˆ¶å°æ‰§è¡Œ `lint`,`eslint`å°†ä¼šæç¤º 1 æ¡é”™è¯¯ä¿¡æ¯ï¼Œè¯´æ˜æ ¡éªŒç”Ÿæ•ˆã€‚

```auto
npmÂ runÂ lint
#Â 1:7Â Â errorÂ Â 'calc'Â isÂ assignedÂ aÂ valueÂ butÂ neverÂ usedÂ Â no-unused-vars
```

å› ä¸ºæ˜¯ Typescript é¡¹ç›®æ‰€ä»¥æˆ‘ä»¬è¿˜è¦æ·»åŠ Standardè§„èŒƒæä¾›çš„ TypeScrip æ‰©å±•é…ç½®(å…¶ä»–è§„èŒƒåŒç†)

å®‰è£…eslint-config-standard-with-typescript

```auto
npm i eslint-config-standard-with-typescript -D
```

æ·»åŠ ä¿®æ”¹ `.eslintrc.cjs`

```auto
Â Â Â Â module.exportsÂ =Â {
Â Â Â Â Â Â env:Â {
Â Â Â Â Â Â Â Â browser:Â true,
Â Â Â Â Â Â Â Â es2021:Â true,
Â Â Â Â Â Â Â Â node:Â true
Â Â Â Â Â Â },
-Â Â Â Â Â extends:Â ['standard']
+Â Â Â Â Â extends:Â ['standard',Â 'eslint-config-standard-with-typescript'],
Â Â Â Â Â Â parser:Â '@typescript-eslint/parser',
Â Â Â Â Â Â parserOptions:Â {
Â Â Â Â Â Â Â Â ecmaVersion:Â 12,
Â Â Â Â Â Â Â Â sourceType:Â 'module',
+Â Â Â Â Â Â Â project:Â './tsconfig.json'
Â Â Â Â Â Â },
Â Â Â Â Â Â plugins:Â ['@typescript-eslint'],
Â Â Â Â Â Â rules:Â {}
Â Â Â Â }

```

éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

åœ¨æ§åˆ¶å°æ‰§è¡Œ`lint`,`eslint`å°†ä¼šæç¤º 2 æ¡é”™è¯¯ä¿¡æ¯ï¼Œè¯´æ˜æ ¡éªŒç”Ÿæ•ˆã€‚

```auto
npmÂ runÂ lint
#Â 1:7Â Â errorÂ Â 'calc'Â isÂ assignedÂ aÂ valueÂ butÂ neverÂ usedÂ Â no-unused-vars
#Â 1:14Â errorÂ Â MissingÂ returnÂ typeÂ onÂ functionÂ 
```

#### Prettier

ç°åœ¨æˆ‘ä»¬æŒ‰ç…§å®˜ç½‘çš„æ¨èæ–¹å¼ï¼ŒæŠŠ `prettier` é›†æˆåˆ° `eslint` çš„æ ¡éªŒä¸­ã€‚

å®‰è£… `prettier` å¹¶åˆå§‹åŒ–é…ç½®æ–‡ä»¶

```auto
npmÂ iÂ prettierÂ -D
echoÂ {}>Â .prettierrc.json
```

ç„¶ååœ¨`.prettierrc.json`æ·»åŠ é…ç½®ï¼Œè¿™é‡Œåªéœ€è¦æ·»åŠ å’Œä½ æ‰€é€‰è§„èŒƒå†²çªçš„éƒ¨åˆ†ã€‚

```auto
{
Â Â "semi":Â false,Â //Â æ˜¯å¦ä½¿ç”¨åˆ†å·
Â Â "singleQuote":Â true,Â //Â ä½¿ç”¨å•å¼•å·ä»£æ›¿åŒå¼•å·
Â Â "trailingComma":Â "none"Â //Â å¤šè¡Œæ—¶å°½å¯èƒ½ä½¿ç”¨é€—å·ç»“å°¾
}
```

æ›´å¤šé…ç½®è¯¦è§ï¼šprettier.io/docs/en/optâ€¦

å®‰è£…è§£å†³å†²çªéœ€è¦ç”¨åˆ°çš„ä¸¤ä¸ªä¾èµ–

-   eslint-config-prettierÂ å…³é—­å¯èƒ½ä¸ `prettier` å†²çªçš„è§„åˆ™
    
-   eslint-plugin-prettierÂ ä½¿ç”¨ `prettier` ä»£æ›¿ `eslint` æ ¼å¼åŒ–
    

```auto
npmÂ iÂ eslint-config-prettierÂ eslint-plugin-prettierÂ -D
```

å†æ·»åŠ ä¿®æ”¹ `.eslintrc.cjs`ï¼Œå¦‚ä¸‹ï¼š

```auto
Â Â module.exportsÂ =Â {
Â Â env:Â {
Â Â Â Â browser:Â true,
Â Â Â Â es2021:Â true,
Â Â Â Â node:Â true,
Â Â },
-Â extends:Â ['standard',Â 'eslint-config-standard-with-typescript'],
+Â extends:Â ['standard',Â 'eslint-config-standard-with-typescript',Â 'prettier'],
Â Â parser:Â '@typescript-eslint/parser',
Â Â parserOptions:Â {
Â Â Â Â ecmaVersion:Â 12,
Â Â Â Â sourceType:Â 'module',
Â Â Â Â project:Â './tsconfig.json',
Â Â },
-Â plugins:Â ['@typescript-eslint'],
+Â plugins:Â ['@typescript-eslint',Â 'prettier'],
-Â rules:Â {},
+Â rules:Â {
+Â Â Â 'prettier/prettier':Â 'error'
+Â },
}
```

ç„¶åéªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œä¿®æ”¹`index.ts`

```auto
-Â Â constÂ calcÂ =Â (a:Â number,Â b:Â number)Â =>Â {
+Â Â constÂ calcÂ =Â (a:Â number,Â b:Â number):Â numberÂ =>Â {
Â Â Â Â returnÂ aÂ -Â b
Â Â }
-Â //Â console.log(calc(1024,Â 28))
+Â console.log(calc(1024,Â 28))
```

ç„¶ååœ¨æ§åˆ¶å°æ‰§è¡Œ`lint`,è¿™é‡Œ`prettier`å’Œ`eslint`çš„è¡Œä¸ºå·²ä¿æŒä¸€è‡´ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œé‚£å°±æˆåŠŸäº†ã€‚

```auto
npmÂ runÂ lint
```

æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†`eslint`å’Œ`prettier`çš„é›†æˆé…ç½®ã€‚å’Œç¼–è¾‘å™¨æ— å…³ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºä½ ä½¿ç”¨ä»€ä¹ˆç¼–è¾‘å™¨ï¼Œæœ‰æ²¡æœ‰å®‰è£…ç›¸å…³æ’ä»¶ï¼Œéƒ½ä¸ä¼šå½±å“ä»£ç æ ¡éªŒçš„æ•ˆæœã€‚

### Husky

å› ä¸ºä¸€ä¸ªé¡¹ç›®é€šå¸¸æ˜¯å›¢é˜Ÿåˆä½œï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯æ¯ä¸ªäººåœ¨æäº¤ä»£ç ä¹‹å‰æ‰§è¡Œä¸€é`lint`æ ¡éªŒï¼Œæ‰€ä»¥éœ€è¦`git hooks` æ¥è‡ªåŠ¨åŒ–æ ¡éªŒçš„è¿‡ç¨‹ï¼Œå¦åˆ™ç¦æ­¢æäº¤ã€‚

å®‰è£…`Husky`å¹¶ç”Ÿæˆ`.husky`æ–‡ä»¶å¤¹

```auto
npmÂ iÂ huskyÂ -D
npxÂ huskyÂ install
```

ç„¶åæˆ‘ä»¬éœ€è¦åœ¨æ¯æ¬¡æ‰§è¡Œ`npm install`æ—¶è‡ªåŠ¨å¯ç”¨`husky`

å¦‚æœä½ çš„`npm`ç‰ˆæœ¬å¤§äºç­‰äº`7.1.0`

```auto
npmÂ set-scriptÂ prepareÂ "huskyÂ install"
```

å¦åˆ™æ‰‹åŠ¨åœ¨`package.json`ä¸­æ·»åŠ 

```auto
Â "scripts":Â {
Â Â Â Â "dev":Â "tscÂ --watch",
Â Â Â Â "build":Â "npmÂ runÂ cleanÂ &&Â tsc",
Â Â Â Â "lint":Â "eslintÂ srcÂ --extÂ .js,.tsÂ --cacheÂ --fix",
Â Â Â Â "clean":Â "rmÂ -rfÂ dist",
+Â Â Â "prepare":Â "huskyÂ install"
Â Â },
```

ç„¶åæ·»åŠ ä¸€ä¸ª`lint`é’©å­

```auto
npx husky add .husky/pre-commit "npm run lint"
```

ç›¸å½“äºæ‰‹åŠ¨åœ¨`.husky/pre-commit`æ–‡ä»¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```auto
#!/bin/sh
.Â "$(dirnameÂ "$0")/_/husky.sh"
npmÂ runÂ lint
```

æµ‹è¯•é’©å­æ˜¯å¦ç”Ÿæ•ˆï¼Œä¿®æ”¹`index.ts`

```auto
Â Â constÂ calcÂ =Â (a:Â number,Â b:Â number):Â numberÂ =>Â {
Â Â Â Â returnÂ aÂ -Â b
Â Â }
-Â console.log(calc(1024,Â 28))
+Â //Â console.log(calc(1024,Â 28))
```

ç„¶åæäº¤ä¸€æ¡`commit`,å¦‚æœé…ç½®æ­£ç¡®å°†ä¼šè‡ªåŠ¨æ‰§è¡Œ`lint`å¹¶æç¤º 1 æ¡é”™è¯¯ä¿¡æ¯ï¼Œ`commit`æäº¤å°†ä¼šå¤±è´¥ã€‚

```auto
gitÂ addÂ .
gitÂ commitÂ -mÂ 'testÂ husky'
#Â 1:7Â Â errorÂ Â 'calc'Â isÂ assignedÂ aÂ valueÂ butÂ neverÂ used
```

### Commitlint

ä¸ºä»€ä¹ˆéœ€è¦ `Commitlint`ï¼Œé™¤äº†åœ¨åç»­çš„ç”Ÿæˆ`changelog`æ–‡ä»¶å’Œè¯­ä¹‰å‘ç‰ˆä¸­éœ€è¦æå–`commit`ä¸­çš„ä¿¡æ¯ï¼Œä¹Ÿåˆ©äºå…¶ä»–åŒå­¦åˆ†æä½ æäº¤çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çº¦å®š`commit`çš„è§„èŒƒã€‚

å®‰è£… `Commitlint`

-   @commitlint/cliÂ Commitlint å‘½ä»¤è¡Œå·¥å…·
    
-   @commitlint/config-conventionalÂ åŸºäº Angular çš„çº¦å®šè§„èŒƒ
    

```auto
npmÂ iÂ @commitlint/config-conventionalÂ @commitlint/cliÂ -D
```

æœ€åå°†`Commitlint`æ·»åŠ åˆ°é’©å­

```auto
npxÂ huskyÂ addÂ .husky/commit-msgÂ 'npxÂ --no-installÂ commitlintÂ --editÂ "$1"'
```

åˆ›å»º`.commitlintrc`ï¼Œå¹¶å†™å…¥é…ç½®

```auto
{
Â Â "extends":Â [
Â Â Â Â "@commitlint/config-conventional"
Â Â ]
}
```

æ³¨æ„ï¼Œè¿™é‡Œé…ç½®æ–‡ä»¶åä½¿ç”¨çš„æ˜¯`.commitlintrc`è€Œä¸æ˜¯é»˜è®¤çš„`.commitlintrc.js`ï¼Œè¯¦è§ Eslint ç« èŠ‚

æµ‹è¯•é’©å­æ˜¯å¦ç”Ÿæ•ˆï¼Œä¿®æ”¹`index.ts`ï¼Œè®©ä»£ç æ­£ç¡®

```auto
Â Â constÂ calcÂ =Â (a:Â number,Â b:Â number):Â voidÂ =>Â {
Â Â Â Â console.log(aÂ -Â b)
Â Â }
-Â //Â calc(1024,Â 28)
+Â calc(1024,Â 28)
```

æäº¤ä¸€æ¡ä¸ç¬¦åˆè§„èŒƒçš„`commit`ï¼Œæäº¤å°†ä¼šå¤±è´¥

```auto
gitÂ addÂ .
gitÂ commitÂ -mÂ 'addÂ eslintÂ andÂ commitlint'
```

ä¿®æ”¹ä¸ºæ­£ç¡®çš„`commit`ï¼Œæäº¤æˆåŠŸï¼

```auto
gitÂ commitÂ -mÂ 'ci:Â addÂ eslintÂ andÂ commitlint'
```

_Angular è§„èŒƒè¯´æ˜ï¼š_

-   _feat_ï¼šæ–°åŠŸèƒ½
    
-   _fix_ï¼šä¿®è¡¥ BUG
    
-   _docs_ï¼šä¿®æ”¹æ–‡æ¡£ï¼Œæ¯”å¦‚ README, CHANGELOG, CONTRIBUTE ç­‰ç­‰
    
-   _style_ï¼šä¸æ”¹å˜ä»£ç é€»è¾‘ (ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€é€—å·ç­‰ç­‰)
    
-   _refactor_ï¼šé‡æ„ï¼ˆæ—¢ä¸ä¿®å¤é”™è¯¯ä¹Ÿä¸æ·»åŠ åŠŸèƒ½ï¼‰
    
-   _perf_ï¼šä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ
    
-   _test_ï¼šå¢åŠ æµ‹è¯•ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰
    
-   _build_ï¼šæ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–é¡¹çš„æ›´æ”¹
    
-   _ci_ï¼šè‡ªåŠ¨åŒ–æµç¨‹é…ç½®æˆ–è„šæœ¬ä¿®æ”¹
    
-   _chore_ï¼šé src å’Œ test çš„ä¿®æ”¹ï¼Œå‘å¸ƒç‰ˆæœ¬ç­‰
    
-   _revert_ï¼šæ¢å¤å…ˆå‰çš„æäº¤
    

### Jest

_ç¾å¥½ç”Ÿæ´»ä»æµ‹è¯•è¦†ç›–ç‡ 100% å¼€å§‹ã€‚_

å®‰è£…`jest`ï¼Œå’Œç±»å‹å£°æ˜`@types/jest`ï¼Œå®ƒæ‰§è¡Œéœ€è¦`ts-node`å’Œ`ts-jest`

è¿™é‡Œæš‚æ—¶å›ºå®šäº†`ts-node`çš„ç‰ˆæœ¬ä¸º `v9.1.1`ï¼Œæ–°ç‰ˆçš„`ts-node@v10.0.0`ä¼šå¯¼è‡´`jest`æŠ¥é”™ï¼Œç­‰å¾…å®˜æ–¹ä¿®å¤ï¼Œè¯¦è§ï¼šissues

```auto
npmÂ iÂ jestÂ @types/jestÂ ts-node@9.1.1Â ts-jestÂ -D
```

åˆå§‹åŒ–é…ç½®æ–‡ä»¶

```auto
npx jest --init
```

ç„¶åä¿®æ”¹`jest.config.ts`æ–‡ä»¶

```auto
Â Â Â //Â AÂ presetÂ thatÂ isÂ usedÂ asÂ aÂ baseÂ forÂ Jest'sÂ configuration
-Â Â //Â preset:Â undefined,
+Â Â preset:Â 'ts-jest'
```

å°†æµ‹è¯•å‘½ä»¤æ·»åŠ åˆ°`package.json`ä¸­ã€‚

```auto
Â Â "scripts":Â {
Â Â Â Â "dev":Â "tscÂ --watch",
Â Â Â Â "build":Â "npmÂ runÂ cleanÂ &&Â tsc",
Â Â Â Â "lint":Â "eslintÂ srcÂ --extÂ .js,.tsÂ --cacheÂ --fix",
Â Â Â Â "clean":Â "rmÂ -rfÂ dist",
Â Â Â Â "prepare":Â "huskyÂ install",
+Â Â Â "test":Â "jest"
Â Â },
```

åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¤¹`__tests__`å’Œæµ‹è¯•æ–‡ä»¶`__tests__/calc.spec.ts`

ä¿®æ”¹`index.ts`

```auto
Â Â constÂ calcÂ =Â (a:Â number,Â b:Â number):Â numberÂ =>Â {
Â Â Â Â returnÂ aÂ -Â b
Â Â }
-Â //Â console.log(calc(1024,Â 28))
+Â exportÂ defaultÂ calc
```

ç„¶ååœ¨`calc.spec.ts`ä¸­å†™å…¥æµ‹è¯•ä»£ç 

```auto
importÂ calcÂ fromÂ '../src'

test('TheÂ calculationÂ resultÂ shouldÂ beÂ 996.',Â ()Â =>Â {
Â Â expect(calc(1024,Â 28)).toBe(996)
})
```

éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

åœ¨æ§åˆ¶å°æ‰§è¡Œ`test`ï¼Œå°†ä¼šçœ‹åˆ°æµ‹è¯•è¦†ç›–ç‡ 100% çš„ç»“æœã€‚

```auto
npmÂ runÂ test
```

æœ€åæˆ‘ä»¬ç»™`__tests__`ç›®å½•ä¹ŸåŠ ä¸Š`lint`æ ¡éªŒ

ä¿®æ”¹`package.json`

```auto
Â Â "scripts":Â {
Â Â Â Â "dev":Â "tscÂ --watch",
Â Â Â Â "build":Â "npmÂ runÂ cleanÂ &&Â tsc",
-Â Â Â "lint":Â "eslintÂ srcÂ --extÂ .js,.tsÂ --cacheÂ --fix",
+Â Â Â "lint":Â "eslintÂ srcÂ __tests__Â --extÂ .js,.tsÂ --cacheÂ --fix",
Â Â Â Â "clean":Â "rmÂ -rfÂ dist",
Â Â Â Â "prepare":Â "huskyÂ install",
Â Â Â Â "test":Â "jest"
Â Â },
```

è¿™é‡Œå¦‚æœæˆ‘ä»¬ç›´æ¥æ‰§è¡Œ`npm run lint`å°†ä¼šæŠ¥é”™ï¼Œæç¤º`__tests__`æ–‡ä»¶å¤¹æ²¡æœ‰åŒ…å«åœ¨`tsconfig.json`çš„`include`ä¸­ï¼Œå½“æˆ‘ä»¬æ·»åŠ åˆ°`include`ä¹‹åï¼Œè¾“å‡ºçš„`dist`ä¸­å°±ä¼šåŒ…å«æµ‹è¯•ç›¸å…³çš„æ–‡ä»¶ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚

æˆ‘ä»¬ä½¿ç”¨`typescript-eslint`å®˜æ–¹ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹æ“ä½œï¼š

æ–°å»ºä¸€ä¸ª`tsconfig.eslint.json`æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```auto
{
Â Â "extends":Â "./tsconfig.json",
Â Â "include":Â ["**/*.ts",Â "**/*.js"]
}
```

åœ¨`.eslintrc.cjs`ä¸­ä¿®æ”¹

```auto
Â Â parserOptions:Â {
Â Â Â Â ecmaVersion:Â 12,
Â Â Â Â sourceType:Â 'module',
-Â Â Â project:Â './tsconfig.json'
+Â Â Â project:Â './tsconfig.eslint.json'
Â Â },
```

ç„¶åéªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œç›´æ¥æäº¤æˆ‘ä»¬æ·»åŠ çš„æµ‹è¯•æ–‡ä»¶,èƒ½æ­£ç¡®æäº¤è¯´æ˜é…ç½®æˆåŠŸã€‚

```auto
gitÂ addÂ .
gitÂ commitÂ -mÂ 'test:Â addÂ unitÂ test'
```

### Github Actions

æˆ‘ä»¬é€šè¿‡`Github Actions`å®ç°ä»£ç åˆå¹¶æˆ–æ¨é€åˆ°ä¸»åˆ†æ”¯ï¼Œ`dependabot`æœºå™¨äººå‡çº§ä¾èµ–ç­‰åŠ¨ä½œï¼Œä¼šè‡ªåŠ¨è§¦å‘æµ‹è¯•å’Œå‘å¸ƒç‰ˆæœ¬ç­‰ä¸€ç³»åˆ—æµç¨‹ã€‚

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`.github/workflows`æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢æ–°å»º`ci.yml`æ–‡ä»¶å’Œ`cd.yml`æ–‡ä»¶

åœ¨`ci.yml`æ–‡ä»¶ä¸­å†™å…¥ï¼š

```auto
name:Â CI

on:
Â Â push:
Â Â Â Â branches:
Â Â Â Â Â Â -Â '**'
Â Â pull_request:
Â Â Â Â branches:
Â Â Â Â Â Â -Â '**'
jobs:
Â Â linter:
Â Â Â Â runs-on:Â ubuntu-latest
Â Â Â Â steps:
Â Â Â Â Â Â -Â uses:Â actions/checkout@v2
Â Â Â Â Â Â -Â uses:Â actions/setup-node@v2
Â Â Â Â Â Â Â Â with:
Â Â Â Â Â Â Â Â Â Â node-version:Â 16
Â Â Â Â Â Â -Â run:Â npmÂ ci
Â Â Â Â Â Â -Â run:Â npmÂ runÂ lint
Â Â tests:
Â Â Â Â needs:Â linter
Â Â Â Â runs-on:Â ubuntu-latest
Â Â Â Â steps:
Â Â Â Â Â Â -Â uses:Â actions/checkout@v2
Â Â Â Â Â Â -Â uses:Â actions/setup-node@v2
Â Â Â Â Â Â Â Â with:
Â Â Â Â Â Â Â Â Â Â node-version:Â 16
Â Â Â Â Â Â -Â run:Â npmÂ ci
Â Â Â Â Â Â -Â run:Â npmÂ runÂ test

```

ä¸Šé¢é…ç½®å¤§æ¦‚æ„æ€å°±æ˜¯ï¼Œç›‘å¬æ‰€æœ‰åˆ†æ”¯çš„`push`å’Œ`pull_request`åŠ¨ä½œï¼Œè‡ªåŠ¨æ‰§è¡Œ`linter`å’Œ`tests`ä»»åŠ¡ã€‚

GithubActions æ›´å¤šç”¨æ³•å‚è€ƒï¼šgithub.com/features/acâ€¦

ç„¶åæ¨é€ä»£ç ï¼ŒéªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

```auto
gitÂ addÂ .
gitÂ commitÂ -mÂ 'ci:Â useÂ githubÂ actions'
gitÂ push
```

æ­¤æ—¶æ‰“å¼€å½“å‰é¡¹ç›®çš„ _Github_ é¡µé¢ï¼Œç„¶åç‚¹å‡»é¡¶éƒ¨ _Actions_ èœå•å°±ä¼šçœ‹åˆ°æ­£åœ¨è¿›è¡Œçš„ä¸¤ä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªå°†ä¼šæˆåŠŸï¼ˆæµ‹è¯•ï¼‰ï¼Œä¸€ä¸ªå°†ä¼šå¤±è´¥ï¼ˆå‘å¸ƒï¼‰ã€‚

ä¸Šé¢åªæ˜¯å®ç°äº†ä»£ç è‡ªåŠ¨æµ‹è¯•æµç¨‹ï¼Œä¸‹é¢å®ç°è‡ªåŠ¨å‘å¸ƒçš„æµç¨‹ã€‚

åœ¨æ­¤ä¹‹å‰éœ€è¦åˆ°NPMç½‘ç«™ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·ï¼ˆå·²æœ‰å¯å¿½ç•¥ï¼‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª`package`ã€‚

ç„¶ååˆ›å»º`GH_TOKEN`å’Œ`NPM_TOKEN`ï¼ˆæ³¨æ„ï¼Œä¸è¦åœ¨ä»£ç ä¸­åŒ…å«ä»»ä½•çš„ TOKEN ä¿¡æ¯ï¼‰ï¼š

-   å¦‚ä½•åˆ›å»º GITHUB\\\_TOKENï¼ˆåˆ›å»ºæ—¶å‹¾é€‰ _repo_ å’Œ _workflow_ æƒé™ï¼‰
    
-   å¦‚ä½•åˆ›å»º NPM\\\_TOKENï¼ˆåˆ›å»ºæ—¶é€‰ä¸­ _Automation_ æƒé™ï¼‰
    

å°†åˆ›å»ºå¥½çš„ä¸¤ä¸ª`TOKEN`æ·»åŠ åˆ°é¡¹ç›®çš„ _Actions secrets_ ä¸­ï¼š

_Github é¡¹ç›®é¦–é¡µ_ -> _é¡¶éƒ¨ Settings èœå•_ -> _ä¾§è¾¹æ  Secrets_

ç„¶åä¿®æ”¹`package.json`ä¸­çš„`â€œnameâ€`ï¼Œ`â€œnameâ€`å°±æ˜¯ä½ åœ¨NPMä¸Šåˆ›å»ºçš„`package`çš„åç§°ã€‚

åœ¨`cd.yml`æ–‡ä»¶ä¸­å†™å…¥ï¼š

```auto
name:Â CD

on:
Â Â push:
Â Â Â Â branches:
Â Â Â Â Â Â -Â main
Â Â pull_request:
Â Â Â Â branches:
Â Â Â Â Â Â -Â main
jobs:
Â Â release:
Â Â Â Â runs-on:Â ubuntu-latest
Â Â Â Â steps:
Â Â Â Â Â Â -Â uses:Â actions/checkout@v2
Â Â Â Â Â Â -Â uses:Â actions/setup-node@v2
Â Â Â Â Â Â Â Â with:
Â Â Â Â Â Â Â Â Â Â node-version:Â 16
Â Â Â Â Â Â #Â https://github.com/semantic-release/git/issues/209
Â Â Â Â Â Â -Â run:Â npmÂ ciÂ --ignore-scripts
Â Â Â Â Â Â -Â run:Â npmÂ runÂ build
Â Â Â Â Â Â -Â run:Â npxÂ semantic-release
Â Â Â Â Â Â Â Â env:
Â Â Â Â Â Â Â Â Â Â GH_TOKEN:Â ${{Â secrets.GH_TOKENÂ }}
Â Â Â Â Â Â Â Â Â Â NPM_TOKEN:Â ${{Â secrets.NPM_TOKENÂ }}
```

ç”±äºâ€œé»‘å‘½è´µâ€ï¼ŒGithub å·²å°†æ–°é¡¹ç›®çš„é»˜è®¤åˆ†æ”¯åç§°æ›´æ”¹ä¸º `â€œmainâ€`ï¼Œè¯¦è§ï¼šissuesï¼Œ ä¸ºäº†æ–¹ä¾¿ï¼Œåé¢ç»Ÿä¸€ç§°ä¸º _ä¸»åˆ†æ”¯_

æ‰€ä»¥å¦‚æœä½ çš„ä¸»åˆ†æ”¯åç§°æ˜¯`â€œmainâ€`ï¼Œä¸Šé¢çš„`branches`éœ€è¦ä¿®æ”¹ä¸ºï¼š

```auto
on:
Â Â push:
Â Â Â Â branches:
Â Â Â Â Â Â -Â main
Â Â pull_request:
Â Â Â Â branches:
Â Â Â Â Â Â -Â main
```

ç„¶åå®‰è£…è¯­ä¹‰å‘ç‰ˆä¾èµ–ï¼Œéœ€è¦ç”¨åˆ°`semantic-release`å’Œå®ƒçš„æ’ä»¶ï¼š

-   semantic-releaseï¼šè¯­ä¹‰å‘ç‰ˆæ ¸å¿ƒåº“
    
-   @semantic-release/changelogï¼šç”¨äºè‡ªåŠ¨ç”Ÿæˆ changelog.md
    
-   @semantic-release/gitï¼šç”¨äºå°†å‘å¸ƒæ—¶äº§ç”Ÿçš„æ›´æ”¹æäº¤å›è¿œç¨‹ä»“åº“
    

```auto
npm i semantic-release @semantic-release/changelog @semantic-release/git -D
```

åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºé…ç½®æ–‡ä»¶`.releaserc`å¹¶å†™å…¥ï¼š

```auto
{
Â Â "branches":Â ["master"],
Â Â "plugins":Â [
Â Â Â Â "@semantic-release/commit-analyzer",
Â Â Â Â "@semantic-release/release-notes-generator",
Â Â Â Â "@semantic-release/changelog",
Â Â Â Â "@semantic-release/github",
Â Â Â Â "@semantic-release/npm",
Â Â Â Â "@semantic-release/git"
Â Â ]
}
```

è¿™é‡ŒåŒæ ·ï¼Œå¦‚æœä½ çš„ä¸»åˆ†æ”¯åç§°æ˜¯`â€œmainâ€`ï¼Œä¸Šé¢çš„`branches`éœ€è¦ä¿®æ”¹ä¸ºï¼š

```auto
Â Â "branches":Â ["+([0-9])?(.{+([0-9]),x}).x",Â "main"],
```

æœ€åæ–°å»ºåˆ†æ”¯ _develop_ åˆ†æ”¯å¹¶æäº¤å·¥ä½œå†…å®¹ã€‚

```auto
gitÂ checkoutÂ -bÂ develop
gitÂ addÂ .
gitÂ commitÂ -mÂ 'feat:Â completeÂ theÂ CI/CDÂ workflow'
gitÂ pushÂ --set-upstreamÂ originÂ develop
gitÂ push
```

ç„¶åå°† _develop_ åˆ†æ”¯åˆå¹¶åˆ° _ä¸»åˆ†æ”¯_ï¼Œå¹¶æäº¤ï¼Œæ³¨æ„ï¼šè¿™ä¸ªæäº¤ä¼šè§¦å‘æµ‹è¯•å¹¶ _å‘å¸ƒç‰ˆæœ¬_ (è‡ªåŠ¨åˆ›å»º`tag`å’Œ`changelog`)

```auto
gitÂ checkoutÂ master
gitÂ mergeÂ develop
gitÂ push
```

å®Œæˆä¸Šé¢æ“ä½œä¹‹åï¼Œæ‰“å¼€ _Github é¡¹ç›®ä¸»é¡µ_ å’Œ _NPM é¡¹ç›®ä¸»é¡µ_ å¯ä»¥çœ‹åˆ°ä¸€ä¸ª _Release_ çš„æ›´æ–°è®°å½•ã€‚

æœ€ååˆ‡å›åˆ° _develop_ åˆ†æ”¯ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æ›´æ–°ä¾èµ–çš„`workflow`ã€‚

åœ¨`.github`æ–‡ä»¶å¤¹ä¸­åˆ›å»º`dependabot.yml`æ–‡ä»¶ï¼Œå¹¶å†™å…¥å†…å®¹ï¼š

```auto
version:Â 2
updates:
Â Â #Â EnableÂ versionÂ updatesÂ forÂ npm
Â Â -Â package-ecosystem:Â 'npm'
Â Â Â Â #Â LookÂ forÂ `package.json`Â andÂ `lock`Â filesÂ inÂ theÂ `root`Â directory
Â Â Â Â directory:Â '/'
Â Â Â Â #Â CheckÂ theÂ npmÂ registryÂ forÂ updatesÂ everyÂ dayÂ (weekdays)
Â Â Â Â schedule:
Â Â Â Â Â Â interval:Â 'weekly'
```

æäº¤å¹¶æŸ¥çœ‹ _workflows_ æ˜¯å¦å…¨éƒ¨é€šè¿‡ï¼Œå†åˆå¹¶åˆ° _ä¸»åˆ†æ”¯_ å¹¶æäº¤ï¼Œè¿™ä¸ªæäº¤ä¸ä¼šè§¦å‘ç‰ˆæœ¬å‘å¸ƒã€‚

```auto
gitÂ pullÂ originÂ master
gitÂ addÂ .
gitÂ commitÂ -mÂ 'ci:Â addÂ dependabot'
gitÂ pushÂ 

gitÂ checkoutÂ master
gitÂ mergeÂ develop
gitÂ push
```

è§¦å‘ç‰ˆæœ¬å‘å¸ƒéœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š

1.  åªæœ‰å½“`push`å’Œ`pull_request`åˆ° _ä¸»åˆ†æ”¯_ ä¸Šæ‰ä¼šè§¦å‘ç‰ˆæœ¬å‘å¸ƒ
    
2.  åªæœ‰`commit`å‰ç¼€ä¸º`feat`ã€`fix`ã€`perf`æ‰ä¼šå‘å¸ƒï¼Œå¦åˆ™è·³è¿‡ã€‚
    

æ›´å¤šå‘å¸ƒè§„åˆ™ï¼Œè¯¦è§ï¼šgithub.com/semantic-reâ€¦

SemanticRelease ä½¿ç”¨æ–¹å¼ï¼Œè¯¦è§ï¼šsemantic-release.gitbook.io

**å¦‚æœä½ èƒ½æ­£ç¡®é…ç½®ä¸Šé¢æ‰€æœ‰æ­¥éª¤ï¼Œå¹¶æˆåŠŸå‘å¸ƒï¼Œé‚£ä¹ˆæ­å–œä½ ï¼ä½ æ‹¥æœ‰äº†ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„é¡¹ç›®ï¼Œå®ƒæ‹¥æœ‰ï¼šè‡ªåŠ¨ä¾èµ–æ›´æ–°ã€æµ‹è¯•ã€å‘å¸ƒï¼Œå’Œè‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚**

å®Œæ•´çš„é¡¹ç›®ç¤ºä¾‹ï¼š@resreq/event-hub

## ç»“è¯­

æœ¬æ–‡æœªæ¶‰åŠåˆ°ï¼šç»„ä»¶åº“ã€Monorepoã€Jenkins CI ç­‰é…ç½®ï¼Œä½†èƒ½è¦†ç›–ç»å¤§éƒ¨å‰ç«¯é¡¹ç›® CI/CD æµç¨‹ã€‚

æœ‰äº›åœ°æ–¹è®²å¾—æ¯”è¾ƒç»†ï¼Œç”šè‡³æœ‰äº›å•°å—¦ï¼Œä½†è¿˜æ˜¯å¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼æ’’èŠ±ï¼ğŸ‰ğŸ‰ğŸ‰

![](https://qn.huat.xyz/mac/20220716185154.png)

**ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—**

ä¸“æ³¨ Node.js æŠ€æœ¯æ ˆåˆ†äº«ï¼Œä» å‰ç«¯ åˆ° Node.js å†åˆ° åç«¯æ•°æ®åº“ï¼Œç¥æ‚¨æˆä¸ºä¼˜ç§€çš„é«˜çº§ Node.js å…¨æ ˆå·¥ç¨‹å¸ˆã€‚ä¸€ä¸ªæœ‰è¶£çš„ä¸”ä¹äºåˆ†äº«çš„äººã€‚åº§å³é“­ï¼šä»Šå¤©æœªå®Œæˆçš„ï¼Œæ˜å¤©æ›´ä¸ä¼šå®Œæˆã€‚

94ç¯‡åŸåˆ›å†…å®¹

å…¬ä¼—å·

Node ç¤¾ç¾¤  

  

æˆ‘ç»„å»ºäº†ä¸€ä¸ªæ°›å›´ç‰¹åˆ«å¥½çš„ Node.js ç¤¾ç¾¤ï¼Œé‡Œé¢æœ‰å¾ˆå¤š Node.jså°ä¼™ä¼´ï¼Œå¦‚æœä½ å¯¹Node.jså­¦ä¹ æ„Ÿå…´è¶£çš„è¯ï¼ˆåç»­æœ‰è®¡åˆ’ä¹Ÿå¯ä»¥ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·è¿›è¡ŒNode.jsç›¸å…³çš„äº¤æµã€å­¦ä¹ ã€å…±å»ºã€‚ä¸‹æ–¹åŠ  è€ƒæ‹‰ å¥½å‹å›å¤ã€ŒNodeã€å³å¯ã€‚

