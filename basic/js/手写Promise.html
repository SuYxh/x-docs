<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ‰‹å†™å®Œæ•´Promise A+ ã€é™„æºç ã€‘ | VitePress</title>
    <meta name="description" content="Life is short, Keep it simple.">
    <link rel="stylesheet" href="/x-docs/assets/style.5f411fd9.css">
    <link rel="modulepreload" href="/x-docs/assets/Home.14321df2.js">
    <link rel="modulepreload" href="/x-docs/assets/AlgoliaSearchBox.efe83c6c.js">
    <link rel="modulepreload" href="/x-docs/assets/app.4c9f31c1.js">
    <link rel="modulepreload" href="/x-docs/assets/basic_js_æ‰‹å†™Promise.md.492477d0.lean.js">
    <link rel="modulepreload" href="/x-docs/assets/app.4c9f31c1.js">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <meta name="twitter:title" content="æ‰‹å†™å®Œæ•´Promise A+ ã€é™„æºç ã€‘ | VitePress">
    <meta property="og:title" content="æ‰‹å†™å®Œæ•´Promise A+ ã€é™„æºç ã€‘ | VitePress">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/x-docs/" aria-label="VitePress, back to home" data-v-675d8756 data-v-4a583abe><img class="logo" src="/x-docs/logo.svg" alt="Logo" data-v-4a583abe> VitePress</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/basic/" data-v-b8818f8c>åŸºç¡€ <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/framework/index" data-v-b8818f8c>æ¡†æ¶ <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/project/" data-v-b8818f8c>å·¥ç¨‹åŒ– <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/node/" data-v-b8818f8c>Node <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/weixin/" data-v-b8818f8c>å¾®ä¿¡ç›¸å…³ <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/tool/" data-v-b8818f8c>å·¥å…· <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/other/" data-v-b8818f8c>å…¶ä»– <!----></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/SuYxh/x-docs" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/basic/" data-v-b8818f8c>åŸºç¡€ <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/framework/index" data-v-b8818f8c>æ¡†æ¶ <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/project/" data-v-b8818f8c>å·¥ç¨‹åŒ– <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/node/" data-v-b8818f8c>Node <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/weixin/" data-v-b8818f8c>å¾®ä¿¡ç›¸å…³ <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/tool/" data-v-b8818f8c>å·¥å…· <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/x-docs/other/" data-v-b8818f8c>å…¶ä»– <!----></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/SuYxh/x-docs" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">CSS</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/x-docs/basic/css/è¶…å‡ºéšè—">è¶…å‡ºéšè—</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/x-docs/basic/css/å¦‚ä½•è§£å†³flexæ–‡æœ¬æº¢å‡ºé—®é¢˜">å¦‚ä½•è§£å†³flexæ–‡æœ¬æº¢å‡ºé—®é¢˜</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/x-docs/basic/css/cssé€‰æ‹©å™¨nth-child">cssé€‰æ‹©å™¨_nth-child()çš„ç”¨æ³•</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">JsvaScript</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/x-docs/basic/js/åˆ¤æ–­è‹¹æœæ‰‹æœºç±»å‹">åˆ¤æ–­è‹¹æœæ‰‹æœºç±»å‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/x-docs/basic/js/æ‰‹å†™Promise">æ‰‹å†™Promise</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#å†™åœ¨å‰é¢çš„è¯">å†™åœ¨å‰é¢çš„è¯</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-a-è§„èŒƒ">Promise A+è§„èŒƒ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promiseåŸºç¡€ç‰ˆ">PromiseåŸºç¡€ç‰ˆ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promiseå¤„ç†å¼‚æ­¥">Promiseå¤„ç†å¼‚æ­¥</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promiseé“¾å¼è°ƒç”¨-æ ¸å¿ƒ">Promiseé“¾å¼è°ƒç”¨(æ ¸å¿ƒ)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å®Œæ•´promiseä»£ç ">å®Œæ•´Promiseä»£ç </a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æµ‹è¯•">æµ‹è¯•</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/x-docs/basic/js/å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•">å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/x-docs/basic/js/reduceä½¿ç”¨å®ä¾‹">reduceä½¿ç”¨å®ä¾‹</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="æ‰‹å†™å®Œæ•´promise-a-ã€é™„æºç ã€‘">æ‰‹å†™å®Œæ•´Promise A+ ã€é™„æºç ã€‘</h1><p><img src="https://qn.huat.xyz/mac/20220724100041.jpg" alt="js-promise"></p><h2 id="å†™åœ¨å‰é¢çš„è¯">å†™åœ¨å‰é¢çš„è¯</h2><p>çœ‹äº†å¸‚é¢ä¸Šçš„ä¸€äº›æ‰‹å†™Promiseï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸æ€ä¹ˆè§„èŒƒï¼Œè¦ä¹ˆæ— æ³•å¤„ç†å¼‚æ­¥ï¼Œè¦ä¹ˆæ²¡æœ‰trycatchï¼Œè¦ä¹ˆæ²¡æœ‰å‘å¸ƒè®¢é˜…çš„åŠŸèƒ½ï¼Œè¦ä¹ˆæ²¡æœ‰å®ç°é“¾å¼è°ƒç”¨ç­‰ç­‰ã€‚é‚£ä¹ˆä»Šå¤©å°±æ¥å®ç°ä¸€ä¸ªç¬¦åˆPromise A+è§„èŒƒçš„ä»£ç ã€‚æ—¢ç„¶æ¥çœ‹æ‰‹å†™ï¼Œé‚£ä¹ˆè‚¯å®šå¯¹Promiseéƒ½æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥ä¸Šæ‰‹ã€‚</p><h2 id="promise-a-è§„èŒƒ">Promise A+è§„èŒƒ</h2><p>Promise/A+è§„èŒƒåŸæ–‡: <a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">https://promisesaplus.com/</a></p><p>Promise/A+è§„èŒƒè¯‘æ–‡: <a href="http://www.ituring.com.cn/article/66566" target="_blank" rel="noopener noreferrer">http://www.ituring.com.cn/article/66566</a></p><p>ä»¥ä¸‹ä¸ºæµ‹è¯•æˆåŠŸæˆªå›¾</p><p><img src="https://qn.huat.xyz/mac/20220723204501.png" alt="image-20220723204501253"></p><h2 id="promiseåŸºç¡€ç‰ˆ">PromiseåŸºç¡€ç‰ˆ</h2><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span>
<span class="token keyword">const</span> <span class="token constant">FAIL</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span>
<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é»˜è®¤æ˜¯ç­‰å¾…æ€</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// åªæœ‰çŠ¶æ€ä¸º PENDING æ—¶æ‰å…è®¸ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºpromiseçŠ¶æ€ä¸å¯é€†</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">SUCCESS</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FAIL</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// new Promise() æŠ¥é”™çš„æ—¶å€™ä¹Ÿä¼šæ‰§è¡Œ reject()</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç«‹å³æ‰§è¡Œ</span>
      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FAIL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise
</code></pre></div><h2 id="promiseå¤„ç†å¼‚æ­¥">Promiseå¤„ç†å¼‚æ­¥</h2><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span>
<span class="token keyword">const</span> <span class="token constant">FAIL</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span>
<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span>
<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é»˜è®¤æ˜¯ç­‰å¾…æ€</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token comment">// å­˜å‚¨æˆåŠŸçš„æ‰€æœ‰çš„å›è°ƒ åªæœ‰pendingçš„æ—¶å€™æ‰å­˜å‚¨</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// å­˜å‚¨æ‰€æœ‰å¤±è´¥çš„</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// åªæœ‰çŠ¶æ€ä¸º PENDING æ—¶æ‰å…è®¸ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºpromiseçŠ¶æ€ä¸å¯é€†</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">SUCCESS</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FAIL</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// executor ä¸­æŠ›å‡ºé”™è¯¯æ—¶ä¹Ÿä¼šæ‰§è¡Œ reject()</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç«‹å³æ‰§è¡Œ</span>
      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * @description:
   * thenæ–¹æ³•ä¼šç”¨åˆ°ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå¤„ç† executor ä¸­çš„å¼‚æ­¥ä»£ç .
   * å¦‚æœresolve()çš„æ˜¯ä¸€ä¸ªPromiseï¼Œä¼šè‡ªåŠ¨å°†è¿™ä¸ªpromiseæ‰§è¡Œï¼Œå¹¶ä¸”é‡‡ç”¨ä»–çš„çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸä¼šå°†æˆåŠŸçš„ç»“æœå‘ä¸‹ä¸€å±‚ä¼ é€’ï¼Œ
   * å¦‚æœthenæ–¹æ³•ä¸­çš„æˆåŠŸæˆ–è€…å¤±è´¥ æ‰§è¡Œçš„æ—¶å€™å‘ç”Ÿé”™è¯¯ ä¼šèµ°ä¸‹ä¸€ä¸ªthençš„å¤±è´¥çš„å›è°ƒ
   * å¦‚æœthenæ–¹æ³•è¿”å›äº†ä¸€ä¸ªå¤±è´¥çš„promiseä»–ä¼šèµ°å¤–å±‚thençš„å¤±è´¥çš„å›è°ƒ
   *  1ã€ï¼ˆthenä¸­ä¼ é€’çš„å‡½æ•°ï¼‰åˆ¤æ–­æˆåŠŸ/å¤±è´¥å‡½æ•°çš„è¿”å›ç»“æœ
   *  2ã€ å¦‚æœæ˜¯ promise åˆ™ï¼Œé‡‡ç”¨å®ƒçš„ç»“æœ
   *  3ã€ å¦‚æœä¸æ˜¯promise åˆ™ï¼Œç»§ç»­å°†ç»“æœä¼ é€’ä¸‹å»
   * @param {*} onFulfilled
   * @param {*} onRejected
   */</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  åŒæ­¥å¤„ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FAIL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœæ˜¯PENDINGçŠ¶æ€ï¼Œé‚£ä¹ˆåº”è¯¥å°†å‡½æ•°å­˜èµ·æ¥ åˆ†ç»„å­˜æ”¾ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœæ˜¯å¼‚æ­¥ï¼Œå…ˆè®¢é˜…å¥½</span>
      <span class="token comment">// push() å‚æ•°ä¸ºä»€ä¹ˆæ˜¯å‡½æ•°ï¼Ÿ</span>
      <span class="token comment">// this.onResolvedCallbacks.push(onFulfilled(this.value));</span>
      <span class="token comment">// è¿™æ ·åšä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯æ— æ³•æ·»åŠ ä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚åœ¨æ·»åŠ å‡½æ•°å‰åšä¸€äº›é€»è¾‘ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨å‡½æ•°çš„æ–¹å¼</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿™é‡Œå¯ä»¥æ·»åŠ é¢å¤–çš„é€»è¾‘</span>
        <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise
</code></pre></div><h2 id="promiseé“¾å¼è°ƒç”¨-æ ¸å¿ƒ">Promiseé“¾å¼è°ƒç”¨(æ ¸å¿ƒ)</h2><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;PENDING&#39;</span>
<span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&#39;FULFILLED&#39;</span>
<span class="token keyword">const</span> <span class="token constant">FAIL</span> <span class="token operator">=</span> <span class="token string">&#39;REJECTED&#39;</span>

<span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¦‚æœ promise2 å’Œ x ç›¸åŒï¼ŒæŠ›å‡ºé”™è¯¯</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&#39;TypeError: Chaining cycle detected for promise #&lt;Promise&gt;&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆ¤æ–­xçš„ç±»å‹</span>
  <span class="token comment">// promise æœ‰nç§å®ç° éƒ½ç¬¦åˆäº†è¿™ä¸ªè§„èŒƒ å…¼å®¹åˆ«äººçš„promise</span>
  <span class="token comment">// ä¸¥è°¨ ğŸ‡¬åº”è¯¥åˆ¤æ–­ åˆ«äººçš„promise å¦‚æœå¤±è´¥äº†å°±ä¸èƒ½åœ¨è°ƒç”¨æˆåŠŸ å¦‚æœæˆåŠŸäº†ä¸èƒ½åœ¨è°ƒç”¨å¤±è´¥</span>
  <span class="token keyword">let</span> called

  <span class="token comment">// æ€ä¹ˆåˆ¤æ–­ xæ˜¯ä¸æ˜¯ä¸€ä¸ªpromise çœ‹ä»–æœ‰æ²¡æœ‰thenæ–¹æ³•</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// å–thenæ–¹æ³•å¯èƒ½ä¼šå‡ºé”™ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ trycatch</span>
      <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœ then ä¸º ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘å°±è®¤ä¸ºä»–æ˜¯ä¸€ä¸ªpromise</span>
        <span class="token comment">// ç›´æ¥ä½¿ç”¨å–å¥½çš„thenï¼Œè€Œä¸æ˜¯ä½¿ç”¨x.thenï¼Œå¦åˆ™ä¼šåœ¨æ¬¡å–å€¼ï¼Œæœ‰å¯èƒ½ç¬¬ä¸€æ¬¡å–å€¼æ²¡æœ‰æŠ¥é”™ï¼Œç¬¬äºŒæ¬¡å–å€¼å°±æŠ¥é”™äº†</span>
        <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
          x<span class="token punctuation">,</span>
          <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœpromiseæ˜¯æˆåŠŸçš„å°±æŠŠç»“æœå‘ä¸‹ä¼ ï¼Œå¦‚æœå¤±è´¥çš„å°±è®©ä¸‹ä¸€ä¸ªäººä¹Ÿå¤±è´¥</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// é˜²æ­¢å¤šæ¬¡è°ƒç”¨æˆåŠŸå’Œå¤±è´¥</span>
            <span class="token comment">// resolve(y)</span>
            <span class="token comment">// ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ é€’å½’ï¼Ÿ æŸ¥çœ‹1.test.js çš„æƒ…å†µ, resolve()è¿”å› promise</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token comment">// é€’å½’</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token comment">// æŠ¥é”™çš„æ—¶å€™å°±ç›´æ¥å¾€ä¸‹èµ°ï¼Œä¸ç”¨å†æ‹…å¿ƒ æ˜¯ä¸æ˜¯ peomise äº†</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// {then:()=&gt;{}}</span>
        <span class="token comment">// è¯´æ˜ x æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œç›´æ¥æˆåŠŸå³å¯</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä¸ºäº†è¾¨åˆ«è¿™ä¸ªpromise é˜²æ­¢è°ƒç”¨å¤šæ¬¡</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
      called <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// xæ˜¯ä¸ªï¼Ÿ å¸¸é‡</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">SUCCESS</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FAIL</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åŒä¸€ä¸ªpromise then å¤šæ¬¡</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç† 2.test.js ä¸­çš„æƒ…å†µ</span>
    onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> val
    onRejected <span class="token operator">=</span>
      <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span>
        <span class="token operator">?</span> <span class="token function-variable function">onRejected</span>
        <span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å°†å¤±è´¥å‘ä¸‹ä¼ é€’</span>
            <span class="token keyword">throw</span> err
          <span class="token punctuation">}</span>
    <span class="token keyword">let</span> promise2
    <span class="token comment">// å¯ä»¥ä¸åœçš„è°ƒç”¨thenæ–¹æ³•,è¿”è¿˜äº†ä¸€ä¸ªæ–°çš„promise</span>
    <span class="token comment">// å¼‚æ­¥çš„ç‰¹ç‚¹ ç­‰å¾…å½“å‰ä¸»æ ˆä»£ç éƒ½æ‰§è¡Œåæ‰æ‰§è¡Œ</span>
    promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ setTimeout ï¼Ÿ å¦‚æœä¸ä½¿ç”¨ setTimeout ï¼Œpromise2 åˆ™ä¼šæŠ¥é”™ï¼Œæ¶‰åŠåˆ°ä»£ç çš„æ‰§è¡Œé¡ºåºé—®é¢˜ï¼Œéœ€è¦å…ˆ newå®Œåå†å°†ç»“æœèµ‹å€¼ç»™ promise2 å¯ä»¥å»æ‰  setTimeout æ‰“å°ä¸€ä¸‹ promise2 çœ‹çœ‹</span>
        <span class="token comment">// setTimeoutä½œç”¨ï¼š ä¸ºäº†ä¿è¯ promise2 å·²ç» new å®Œäº†</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// try catch ç”¨äº æ•è· onFulfilled å‡½æ•°çš„å¼‚å¸¸ï¼Œæ¯”å¦‚ åœ¨æ‰§è¡Œ onFulfilled å‡½æ•°çš„æ—¶å€™æŠ›é”™ï¼Œ æˆ–è€… onFulfilled å‡½æ•°ä¸­ æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯</span>
          <span class="token comment">// constructor ä¸­çš„ try catch æ— æ³•æ•è·è¿™é‡Œå¼‚æ­¥ä»£ç çš„å¼‚å¸¸</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è°ƒç”¨å½“å‰thenæ–¹æ³•çš„ç»“æœï¼Œæ¥åˆ¤æ–­å½“å‰è¿™ä¸ªpromise2 æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥</span>
            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token comment">// è¿™é‡Œçš„xæ˜¯æ™®é€šå€¼è¿˜æ˜¯promise  å¦‚æœæ˜¯ä¸€ä¸ªpromiseå‘¢ï¼Ÿ</span>
            <span class="token comment">// console.log(&#39;then-SUCCESS&#39;, promise2);</span>
            <span class="token comment">// åˆ¤æ–­ x å’Œ promise2 å’Œ promise çš„å…³ç³»</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise2--catch &#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FAIL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> promise2
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise
</code></pre></div><h4 id="_1-test-js">1.test.js</h4><div class="language-js"><pre><code><span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./promise&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;1000&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-test-js">2.test.js</h4><div class="language-js"><pre><code><span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./promise&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="å®Œæ•´promiseä»£ç ">å®Œæ•´Promiseä»£ç </h2><p><a href="https://github.com/SuYxh/Write_Promise_A_Plus" target="_blank" rel="noopener noreferrer">https://github.com/SuYxh/Write_Promise_A_Plus</a></p><h2 id="æµ‹è¯•">æµ‹è¯•</h2><p>ä½¿ç”¨<code>promises-aplus-tests</code>è¿™ä¸ªåº“æ˜¯å¦ç¬¦åˆ promise A+è§„èŒƒ</p><div class="language-"><pre><code>npm i promises-aplus-tests -g
</code></pre></div><p>ç„¶ååœ¨promiseä¸­æ·»åŠ ï¼š</p><div class="language-js"><pre><code>Promise<span class="token punctuation">.</span>defer <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function-variable function">deferred</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> dfd <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  dfd<span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    dfd<span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
    dfd<span class="token punctuation">.</span>reject <span class="token operator">=</span> reject<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> dfd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç„¶åæ‰§è¡Œï¼š</p><div class="language-"><pre><code>promises-aplus-tests promise.js
</code></pre></div><p><img src="https://qn.huat.xyz/mac/20220723215501.png" alt="image-20220723204501253"></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/SuYxh/x-docs/edit/master/docs/basic/js/æ‰‹å†™Promise.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>ä¸Šæ¬¡æ›´æ–°:</span><span class="datetime" data-v-5797b537></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/x-docs/basic/js/åˆ¤æ–­è‹¹æœæ‰‹æœºç±»å‹" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>åˆ¤æ–­è‹¹æœæ‰‹æœºç±»å‹</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/x-docs/basic/js/å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•" data-v-38ede35f><span class="text" data-v-38ede35f>å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"dd0a0799\",\"basic_index.md\":\"7e05005e\",\"components_button.md\":\"3782a287\",\"components_modal.md\":\"de0e38e4\",\"components_tabs.md\":\"8a6fd7e0\",\"components_tag.md\":\"e2091d33\",\"components_vue-script.md\":\"31985451\",\"components_vue.md\":\"92189f54\",\"framework_index.md\":\"dba588ae\",\"framework_tabs.md\":\"98e88399\",\"node_index.md\":\"065bf408\",\"node_pm2è‡ªåŠ¨éƒ¨ç½²nodeé¡¹ç›®.md\":\"96a117f3\",\"node_zxä½¿ç”¨æ•™ç¨‹.md\":\"bb227143\",\"node_å‰ç«¯é¡¹ç›®éƒ¨ç½²è®°.md\":\"786ec072\",\"other_index.md\":\"ad489d37\",\"other_å´å†›ï¼šåŠŸå¤«æ²¡ä¸‹å¤Ÿï¼Œç”¨ä»€ä¹ˆæ–¹æ³•éƒ½æ˜¯åœ¨æµªè´¹æ—¶é—´.md\":\"761684a0\",\"other_ç”µå•†ç®¡ç†åå°apiæ¥å£æ–‡æ¡£.md\":\"08f48f18\",\"project_index.md\":\"961312fe\",\"project_è¶…å…¨é¢çš„å‰ç«¯å·¥ç¨‹åŒ–é…ç½®æŒ‡å—.md\":\"ebefa242\",\"tool_index.md\":\"50baeb96\",\"weixin_index.md\":\"31005892\",\"basic_css_cssé€‰æ‹©å™¨nth-child.md\":\"a9ffd944\",\"basic_css_å¦‚ä½•è§£å†³flexæ–‡æœ¬æº¢å‡ºé—®é¢˜.md\":\"3f7a9983\",\"basic_css_è¶…å‡ºéšè—.md\":\"5c11e7d2\",\"basic_js_reduceä½¿ç”¨å®ä¾‹.md\":\"f3769c5c\",\"basic_js_åˆ¤æ–­è‹¹æœæ‰‹æœºç±»å‹.md\":\"c32a9545\",\"basic_js_å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•.md\":\"5e35c4db\",\"basic_js_æ‰‹å†™promise.md\":\"492477d0\",\"framework_vue-article_vueé¡¹ç›®æ€§èƒ½ä¼˜åŒ–å®æˆ˜æ€»ç»“.md\":\"eaa3bac6\",\"framework_vue-article_æœ€è¯¦ç»†çš„ vue3 + typescript ä½¿ç”¨æ•™ç¨‹.md\":\"53b25a33\",\"framework_vue-component_è¿›åº¦æ¡ç»„ä»¶.md\":\"2164543a\",\"node_egg_eggå®ç°æ–‡ä»¶ä¸Šä¼ .md\":\"1662579f\",\"node_sequelize_sequelizeç®€å•ä½¿ç”¨.md\":\"df09c527\",\"weixin_mini-program_å°ç¨‹åºæ¸²æŸ“markdown.md\":\"0722d789\",\"weixin_mini-program_å°ç¨‹åºè§£æå¯Œæ–‡æœ¬.md\":\"181ca043\"}")</script>
    <script type="module" async src="/x-docs/assets/app.4c9f31c1.js"></script>
  </body>
</html>